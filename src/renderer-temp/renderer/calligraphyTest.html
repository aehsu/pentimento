<html>
    <head>
        <script src="jquery.js"></script>
    </head>
    <body>
        <canvas width=400 height=400></canvas>
    </body>
    <script>
        var angle = 0, s = 0, l = 0, log = [], cosb; // 64 max
        
        var canvas = $('canvas');
        var ctx = canvas[0].getContext('2d');
        
        function draw() {
            
            ctx.clearRect(0, 0, 400, 400);
            
            ctx.beginPath();
            
            ctx.moveTo(200 + 200 * Math.cos(s), 200 + 200 * Math.sin(s));
            ctx.lineTo(200, 200);
            ctx.lineTo(200 + 200 * Math.cos(l), 200 + 200 * Math.sin(l));
            ctx.lineTo(200 + 200 * Math.cos(l) + 5, 200 + 200 * Math.sin(l) - 5);
            ctx.lineTo(205, 195);
            ctx.lineTo(200 + 200 * Math.cos(s) + 5, 200 + 200 * Math.sin(s) - 5);
            ctx.lineTo(200 + 200 * Math.cos(s), 200 + 200 * Math.sin(s));
            
            ctx.stroke();
            ctx.fill();
        }
        
        draw();
        
        $(window).on('keydown', function(e) {
            var point = {
                x: 200 + 200 * Math.cos(s),
                y: 200 + 200 * Math.sin(s)
            };
            var next = {
                x: 200,
                y: 200
            };
            var ab = getDistance(Math.round(point.x), Math.round(point.y), Math.round(next.x), Math.round(next.y)),
                bc = getDistance(Math.round(next.x), Math.round(next.y), Math.round(next.x)+5, Math.round(next.y)+5),
                ac = getDistance(Math.round(point.x), Math.round(point.y), Math.round(next.x)+5, Math.round(next.y)+5);
            if(ab !== 0 & bc !== 0) {
                var newcosb = (Math.pow(ab,2)+Math.pow(bc,2)-Math.pow(ac,2))/(2*ab*bc);
                if(!isNaN(newcosb) & Math.abs(newcosb) > 0.3) {
                    if(cosb !== undefined & newcosb/cosb <= 0) {
                        ctx.fillStyle = '#ff0000';
                    }
                    else {
                        ctx.fillStyle = '#000000';
                    }
                    cosb = newcosb;
                }
            }
            
            if (e.which === 39) angle++;
            if (e.which === 37) angle--;
            angle = angle % 64;
            l = angle % 8 * Math.PI / 4;
            s = Math.floor(angle / 8) * Math.PI / 4;
            
            point = {
                x: 200,
                y: 200
            };
            next = {
                x: 200 + 200 * Math.cos(l),
                y: 200 + 200 * Math.sin(l)
            };
            var ab = getDistance(Math.round(point.x), Math.round(point.y), Math.round(next.x), Math.round(next.y)),
                bc = getDistance(Math.round(next.x), Math.round(next.y), Math.round(next.x)+5, Math.round(next.y)+5),
                ac = getDistance(Math.round(point.x), Math.round(point.y), Math.round(next.x)+5, Math.round(next.y)+5);
            if(ab !== 0 & bc !== 0) {
                var newcosb = (Math.pow(ab,2)+Math.pow(bc,2)-Math.pow(ac,2))/(2*ab*bc);
                if(!isNaN(newcosb) & Math.abs(newcosb) > 0.3) {
                    if(cosb !== undefined & newcosb/cosb < 0) {
                        ctx.fillStyle = '#ff0000';
                        ctx.strokeStyle = '#ff0000';
                    }
                    else {
                        ctx.fillStyle = '#000000';
                        ctx.strokeStyle = '#000000';
                    }
                    cosb = newcosb;
                }
            }
            
            draw();
        });
        
        function getDistance(v1, v2, x, y){
            var x1 = v1.x,
                x2 = v2.x,
                y1 = v1.y,
                y2 = v2.y;
            if (x !== undefined) {
                x1 = v1;
                y1 = v2;
                x2 = x;
                y2 = y;
            }
            return Math.sqrt( (x2-x1)*(x2-x1) + (y2-y1)*(y2-y1));
        }
    </script>
</html>
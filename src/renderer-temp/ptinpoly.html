<html>
    <body>
        <canvas id="canvas" width=800 height=600></canvas>
    </body>
    <script>
        //+ Jonas Raoni Soares Silva
        //@ http://jsfromhell.com/math/is-point-in-poly [rev. #0]
        function isPointInPoly(poly, pt){
            for(var c = false, i = -1, l = poly.length, j = l - 1; ++i < l; j = i)
                ((poly[i].y <= pt.y && pt.y < poly[j].y) || (poly[j].y <= pt.y && pt.y < poly[i].y))
                && (pt.x < (poly[j].x - poly[i].x) * (pt.y - poly[i].y) / (poly[j].y - poly[i].y) + poly[i].x)
                && (c = !c);
            return c;
        }
        
        // TEST WITH RANDOM POINTS
        
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        
        var polygon = [];
        var points = [];
        
        //generate 100 random points
        for(var i=0; i<100; i++) {
            points.push({x: Math.round(Math.random()*800),
                         y: Math.round(Math.random()*600)});
        }
        
        //draw selection polygon and highlight selected points
        function draw() {
            canvas.width = canvas.width;
            if(polygon.length > 0)
                context.moveTo(polygon[0].x, polygon[0].y);
            for(var i=1; i<polygon.length; i++) {
                context.lineTo(polygon[i].x, polygon[i].y)
            }
            context.closePath();
            context.stroke();
            for(var i=0; i<points.length; i++) {
                if(isPointInPoly(polygon, points[i]))
                    context.fillRect(points[i].x-4, points[i].y-4, 8, 8);
                else
                    context.fillRect(points[i].x-1, points[i].y-1, 2, 2);
            }
        }
        draw();
        
        var drawing = false;
        canvas.addEventListener('mousedown', function(e) {
            drawing = true;
            polygon = [];
        });
        canvas.addEventListener('mousemove', function(e) {
            if(drawing) {
                // update the selection polygon
                polygon.push({x: e.pageX-canvas.offsetLeft,
                              y: e.pageY-canvas.offsetTop});
                draw();
            }
        });
        canvas.addEventListener('mouseup', function(e) {
            drawing = false;
        });
    </script>
</html>